<specification xmlns="http://docbook.org/ns/docbook" xmlns:cs="http://www.w3.org/XML/XProc/2006/04/components#" xmlns:e="http://www.w3.org/1999/XSL/Spec/ElementSyntax" xmlns:p="http://www.w3.org/ns/xproc" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" class="ed" role="step" version="5.0-extension w3c-xproc">
<info>
<title>XProc 3.0: Validate with Schematron</title>

<copyright><year>2018</year><holder>@@FIXME:</holder></copyright>

<bibliorelation type="isformatof" xlink:href="specification.xml">XML</bibliorelation>
<authorgroup>
  <author>
    <personname>Achim Berndzen</personname>
  </author>
  <author>
    <personname>Gerrit Imsieke</personname>
  </author>
  <author>
    <personname>Erik Siegel</personname>
  </author>
  <author>
    <personname>Norman Walsh</personname>
  </author>
</authorgroup>

<abstract>
<para>This specification describes the <code>p:validate-with-schematron</code>
step for
<citetitle>XProc 3.0: An XML Pipeline Language</citetitle>.</para>
</abstract>

<legalnotice role="status">

<para><emphasis>This section describes the status of this document at
the time of its publication. Other documents may supersede this
document.</emphasis></para>

<para>This document is derived from
<link xlink:href="https://www.w3.org/TR/2010/REC-xproc-20100511/">XProc:
An XML Pipeline Language</link> published by the W3C.</para>
</legalnotice>
</info>

<section xml:id="introduction">
<title>Introduction</title>

<para>This specification describes the
<code>p:validate-with-schematron</code> XProc step.
A machine-readable description of
these steps may be found in
<link xlink:href="steps.xpl">steps.xpl</link>.</para>

<para>Familarity with the
general nature of <biblioref linkend="xproc30"/>
steps is assumed; for background details, see
<biblioref linkend="xproc30-steps"/>.</para>
</section>

<section xml:id="step">
<title>Validate with Schematron</title>

<para>The <tag>p:validate-with-schematron</tag> step applies
<biblioref linkend="iso19757-3"/>
processing to the <port>source</port> document.</para>

<p:declare-step type="p:validate-with-schematron">
  <p:input port="source" primary="true" content-types="application/xml text/xml */*+xml"/>
  <p:input port="schema" content-types="application/xml text/xml */*+xml"/>
  <p:output port="result" primary="true" content-types="application/xml"/>
  <p:output port="report" sequence="true" content-types="application/xml"/>
  <p:option name="parameters" as="map(xs:QName,item())"/>
  <p:option name="phase" select="'#ALL'" as="xs:string"/>
  <p:option name="assert-valid" select="true()" as="xs:boolean"/>
</p:declare-step>

<para><error code="C0054">It is a <glossterm>dynamic error</glossterm>
if the <option>assert-valid</option> option is <literal>true</literal>
and any Schematron assertions fail.</error></para>

<para>The value of the <option>phase</option> option identifies the
Schematron validation phase with which validation begins.</para>

<para>The <option>parameters</option> option provides name/value pairs which
correspond to Schematron external variables.</para>

<para>The <port>result</port> output from this step is a copy of the
input.</para>

<para>Schematron assertions and reports, if any,
<rfc2119>must</rfc2119> appear on the <port>report</port> port. The
output <rfc2119>should</rfc2119> be in <citetitle>Schematron
Validation Report Language</citetitle> (SVRL).</para>

<para>The output of this step
<rfc2119>may</rfc2119> include PSVI annotations.</para>

<section>
<title>Document properties</title>
<para feature="validate-with-schematron-preserves-all">All document properties
on the <port>source</port> port are preserved on the <port>result</port> port.
No document properties on the <port>schemas</port> port are preserved. No document
properties are preserved on the <port>report</port> port.</para>
</section>
</section>

<section xml:id="errors">
<title>Step Errors</title>

<para>This step can raise
<glossterm baseform="dynamic-error">dynamic errors</glossterm>.</para>

<para>A <termdef xml:id="dt-dynamic-error">A <firstterm>dynamic
error</firstterm> is one which occurs while a pipeline is being
evaluated.</termdef> Examples of dynamic errors include references to
URIs that cannot be resolved, steps which fail, and pipelines that
exhaust the capacity of an implementation (such as memory or disk
space).</para>

<para>If a step fails due to a dynamic error, failure propagates
upwards until either a <tag>p:try</tag> is encountered or the entire
pipeline fails. In other words, outside of a <tag>p:try</tag>, step
failure causes the entire pipeline to fail.</para>

<para>The following errors can be raised by this step:</para>

<?step-error-list level="none"?>

</section>

<appendix xml:id="references">
<title>References</title>
<bibliolist>
<bibliomixed xml:id="xproc30"><abbrev>XProc 3.0</abbrev>
<citetitle xlink:href="http://spec.xproc.org/">XProc 3.0:
An XML Pipeline Language</citetitle>.
Achim Berndzen, Gerrit Imsieke, Erik Seigel and Norman Walsh, editors.
</bibliomixed>
<bibliomixed xml:id="xproc30-steps"><abbrev>XProc 3.0 Steps</abbrev>
<citetitle xlink:href="http://spec.xproc.org/">XProc 3.0 Steps:
An Introduction</citetitle>.
Achim Berndzen, Gerrit Imsieke, Erik Seigel and Norman Walsh, editors.
</bibliomixed>
<bibliomixed xml:id="iso19757-3"><abbrev>Schematron</abbrev>ISO/IEC JTC 1/SC 34.
<citetitle>ISO/IEC 19757-3:2006(E) Document Schema Definition
Languages (DSDL) — Part 3: Rule-based validation — Schematron</citetitle>
2006.
</bibliomixed>
</bibliolist>
</appendix>

<!-- This glossary will automatically be elided if there are no
     terms marked up as 'firstterm's in this specification. -->
<appendix xmlns:db="http://docbook.org/ns/docbook" xml:id="glossary"><title>Glossary</title><glosslist><glossentry><glossterm>dynamic
error</glossterm><glossdef><para>A <firstterm>dynamic
error</firstterm> is one which occurs while a pipeline is being
evaluated.</para></glossdef></glossentry></glosslist></appendix>

</specification>